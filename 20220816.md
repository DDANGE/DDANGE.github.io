# íƒ€ì´ë‹ˆê·¸ë¨ ì»¨í…ì¸  ì„œë²„ ë””ìì¸

### ğŸ”· ì„ ë¬¼í•˜ê¸°

1. ì„ ë¬¼ë¦¬ìŠ¤íŠ¸ 
    - UT_GiftList í…Œì´ë¸”ì¶”ê°€ 
    - Column : user_Idx, ItemIDX, Count, gift_count_last_update_date

2. ì„ ë¬¼í•˜ê¸° íšŸìˆ˜ ì„œë²„ê´€ë¦¬ 
    * GetGiftList ìš”ì²­ì‹œ Rowê°€ ì—†ë‹¤ë©´ Insert 
    * GiftCount -> itemìœ¼ë¡œ êµ¬ë¶„ ì§“ê³  UT_GiftListì—ì„œ ê´€ë¦¬
       ST_Item -> Idx = 5ë¡œ ìœ ë£Œì¬í™” íƒ€ì…ìœ¼ë¡œ ì§€ì •
    * ì„ ë¬¼ ê°€ëŠ¥ íšŸìˆ˜ ë¦¬ì…‹ (ì¼ì¼)
        - ì„ ë¬¼ ë¦¬ìŠ¤íŠ¸ ìš”ì²­ì‹œ UT_GiftList -> last_update_date ? <= Today

3. ì„ ë¬¼êµ¬ë§¤ (ë‹¤ì´ì•„) 
4. ì„ ë¬¼í•˜ê¸° íšŸìˆ˜ êµ¬ë§¤(ë‹¤ì´ì•„)

---
### ğŸ”· ë­í‚¹
Redis í™œìš© 
Sorted Set

AT_RankSeason í…Œì´ë¸” ìƒì„±
idx, season_start_time, season_end_time, season_reward_flag

Collection = relation_rank_{0}_{1} = {0} idx, {1}MemberIDX = ìƒìˆ˜(1~7) 
(ì£¼ì°¨ë³„ ì ìš© TTLê°’ 30ì¼ ì§€ì • ìë™ì‚­ì œ)
Key = UserIDX
Value = relationPoint - ì£¼ë§ˆë‹¤ ì´ˆê¸°í™”
ST_Define -> RANK_SEASON_DAY, RANK_CHECK_TIME 

1. í˜¸ê°ë„
2. ë©¤ë²„ë³„ ë­í‚¹ë³´ë“œ (7ê°œ)
4. ì£¼ë§ˆë‹¤ ì´ˆê¸°í™”

---
### ğŸ”· ë­í‚¹ì§‘ê³„
 * Linux Cron í™œìš©
 
 1. 1ì£¼ì¼ ì£¼ê¸°
    - ë­í‚¹ì§‘ê³„ 
    - ë³´ìƒìš°í¸ ë°œì†¡
    
---

### ğŸ”· Protocol
<br>

1ï¸âƒ£ **GetTinygramInfo** íƒ€ì´ë‹ˆê·¸ë¨ ì •ë³´ ìš”ì²­ 
    * ì„ ë¬¼ë¦¬ìŠ¤íŠ¸ì™€ ì„ ë¬¼ê°€ëŠ¥íšŸìˆ˜ ë°ì´í„° ìš”ì²­


Request
DESC : ì„œë²„ëŠ” itemtype = 5ëŠ” last_update_date ì²´í¬í›„ gift_countì´ˆê¸°í™”ê°€ ì´ë¤„ì§€ì§€ ì•Šì•˜ìœ¼ë©´ ì¼ì¼ì¶©ì „ëŸ‰(7ê°œ)ì´ˆê¸°í™” í›„ ë°ì´í„°ë¥¼ ë³´ë‚´ì¤€ë‹¤. 

```json
{
	"id": "eae7c783",
	"method" : 1000,
	"params" : {},
	"sess" : "ce3ad94c7971c62a7de3718b2fde66f31463e1a0e1122865a0801583"
}
```

Response
DESC : í´ë¼ì´ì–¸íŠ¸ëŠ” itemtype = 5 ëŠ” ì„ ë¬¼ ê°€ëŠ¥ íšŸìˆ˜ì´ë¯€ë¡œ ë³„ë„ ì²˜ë¦¬í•œë‹¤.

```json
{
	"id": "eae7c783",
	"result":
    {
        "tinygram_gift_info" :
        [
            {
                "type" : 5,
                "idx" : 5,
                "cnt" : 7
            },
            {
                "type" : 50,
                "idx" : 12,
                "cnt" : 35
            },
            {
                "type" : 50,
                "idx" : 35,
                "cnt" : 124
            }
        ]
	},
	"server_time" : 1648091997
}
```
	
	* Response Data 
		1. ê° ë§´ë²„ë³„ ë­í‚¹ ìˆœìœ„ 1~10ìœ„
		2. í˜„ì¬ ìœ ì € ë©¤ë²„ë³„ í˜¸ê°ë„ 
		3. ì„ ë¬¼ ê°€ëŠ¥ íšŸìˆ˜
	
<br><br><br>

2ï¸âƒ£ **Request(method: ) ë§´ë²„ë³„ 1~10ìˆœìœ„ì™€ ìì‹ ì˜ ë­í‚¹ì •ë³´ ìš”ì²­**

params : memberIdx (1~7)

Request
DESC : ë©¤ë²„IDXì— í•´ë‹¹í•˜ëŠ” 1~10ìœ„ê¹Œì§€ ë­í‚¹ ìœ ì € ì •ë³´ì™€ í˜„ì¬ í”Œë ˆì´ì–´ì˜ ì •ë³´ë¥¼ ìš”ì²­

```json
{
	"id": "eae7c783",
	"method" : 1000,
	"params" : { 
		"member_idx" : 3,
	},
	"sess" : "ce3ad94c7971c62a7de3718b2fde66f31463e1a0e1122865a0801583"
}
```

Response

```json
{
	"id": "eae7c783",
	"result":
    {
        "member_idx" : 1,
        "rank" : 
        [
            {
                "rank" : 1, 
                "nick" : "1ë“±ìœ ì €",
                "score" : 100
            },
            {
                "rank" : 2, 
                "nick" : "2ë“±ìœ ì €",
                "score" : 80
            }	
        ],
        "mine" :
        {
            "rank" : 213213,
            "score" : 12
        }
    },
	"server_time" : 1648091997
}
```
<br><br><br>

2ï¸âƒ£ **SendGift** ì„ ë¬¼ë³´ë‚´ê¸°
Request
member_idx = ë©¤ë²„idx
item = ì„ ë¬¼í•˜ëŠ” ì•„ì´í…œ ì •ë³´
```json
{
	"id": "eae7c783",
	"method" : 1000,
	"params" : { 
        "member_idx" : 1,
        "item" : 
        {
            "type" : 50,
    		"idx" : 50,
            "cnt" : 10
        }
	},
	"sess" : "ce3ad94c7971c62a7de3718b2fde66f31463e1a0e1122865a0801583"
}
```

Response
ë­í¬ ì§‘ê³„ì‹œê°„ í™•ì¸ ì„ ë¬¼ ê°€ëŠ¥ì‹œê°„ ì²´í¬

MemberIDX = ì„ ë¬¼ì„ ë°›ì€ ë©¤ë²„IDX
mine = ì„ ë¬¼ ë³´ë‚´ê¸° ì´í›„ ëˆ„ì  ìŠ¤ì½”ì–´ ì •ë³´
item = ì†Œì§„í•œ ì•„ì´í…œ ì •ë³´
```json
{
	"id": "eae7c783",
	"result":
    {
        "member_idx" : 1,
        "mine" : {
            "rank" : 213213,
            "score" : 12
        },
        "item" :
        {
                "type" : 5,
                "idx" : 5,
                "cnt" : 7
        }
	},
	"server_time" : 1648091997
}
```

<br><br><br>

3ï¸âƒ£ **BuyGift** ì„ ë¬¼êµ¬ë§¤
Request
idx = ST_Item -> Idx 
```json
{
	"id": "eae7c783",
	"method" : 1000,
	"params" : { 
		"idx" : 1,
		"cnt" : 10
	},
	"sess" : "ce3ad94c7971c62a7de3718b2fde66f31463e1a0e1122865a0801583"
}
```

Response
idx = ST_Item -> Idx êµ¬ë§¤í•œ ì•„ì´í…œ idx
totalCnt = êµ¬ë§¤ì„±ê³µí›„ ëˆ„ì  ì•„ì´í…œ ê°¯ìˆ˜
```json
{
	"id": "eae7c783",
	"result":
    {
        "item" :
        {
                "type" : 5,
                "idx" : 5,
                "cnt" : 7
        },
        "user" :
        {
            "cash" : 10,
            "free_cash" : 5
        }
    },
	"server_time" : 1648091997
}
```
<br><br><br>

4ï¸âƒ£ **BuyGiftChance** ì„ ë¬¼í•˜ê¸° íšŸìˆ˜ êµ¬ë§¤
Request
DESC : êµ¬ë§¤í•˜ë ¤ëŠ” ê°¯ìˆ˜ë¥¼ ìš”ì²­
```json
{
	"id": "eae7c783",
	"method" : 1000,
	"params" : { 
		"cnt" : 3,
	},
	"sess" : "ce3ad94c7971c62a7de3718b2fde66f31463e1a0e1122865a0801583"
}
```

Response
DESC : ì„œë²„ëŠ” ì¬í™”í™•ì¸í›„ ì°¨ê°

êµ¬ë§¤ì„±ê³µì´í›„ ëˆ„ì  ì„ ë¬¼ê°€ëŠ¥íšŸìˆ˜ ì „ì†¡
```json
{
	"id": "eae7c783",
	"result":
    {
        //ì¹´ìš´íŠ¸ ì •ë³´
        "item" : 
        {
            "idx" : 5,
            "type" : 5,
            "cnt" : 7
        }
	},
	"server_time" : 1648091997
}
```